<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/react.js"></script>
    <script src="js/react-dom.js"></script>
    <script src="js/browser.min.js"></script>
</head>
<body>

    <div id="example"></div>

    <script type="text/babel">

        var Todo = React.createClass({
            getInitialState: function () {
                return {
                    title: this.props.title,
                    isCompleted: this.props.isCompleted,
                    editing: false
                };
            },

            checkBoxClick: function () {
                this.setState({isCompleted: !this.state.isCompleted});
            },

            save: function () {

                this.setState({
                    editing: false,
                    title: this.refs.textInput.value
                });

                this.props.updateHandler(this.state);
            },

            edit: function () {
                this.setState({editing: true});
            },

            deleteAction: function()
            {
                this.props.deleteHandler(this.props.index);
            },

            renderNormal: function () {
                var labelStyle = {
                    'text-decoration': this.state.isCompleted ? 'line-through' : 'none'
                };

                return (
                        <div className="todo">
                            <label style={labelStyle}>
                                <input
                                        type="checkbox"
                                        onClick={this.checkBoxClick}
                                        defaultChecked={this.state.isCompleted}
                                />
                                {this.state.title}
                            </label>
                            <button onClick={this.edit}>Edit</button>
                            <button onClick={this.deleteAction}>Delete</button>
                        </div>
                );
            },

            renderForm: function () {

                return (
                        <div className="todo">
                            <div>
                                <textarea ref="textInput" defaultValue={this.state.title}></textarea>
                            </div>
                            <div>
                                <button type="button" onClick={this.save}>Save</button>
                            </div>
                        </div>
                );
            },

            render: function () {

                if (this.state.editing)
                {
                    return this.renderForm();
                }
                else
                {
                    return this.renderNormal();
                }
            }
        });

        var TodoList = React.createClass({

            getInitialState: function () {
                return {
                    todos: [
                        {
                            title: 'First todo',
                            isCompleted: true
                        },
                        {
                            title: 'To buy book',
                            isCompleted: false
                        },
                        {
                            title: 'Make dinner',
                            isCompleted: false
                        },
                        {
                            title: 'Make breakfast',
                            isCompleted: true
                        }
                    ]
                };
            },

            deleteHandler: function (index) {

                var todo = this.state.todos[index];
                console.log("Deleting todo: '" + todo.title + "'");

                delete this.state.todos[index];
                this.setState(this.state);
            },

            updateHandler: function (todo, index) {
                this.state.todos[index] = todo;
                this.setState(this.state);
            },

            render: function () {
                var self = this;

                return (
                        <div className="todo-list">
                            {

                                this.state.todos.map(function(todo, index){
                                    return (
                                            <Todo
                                                    key={index}
                                                    index={index}
                                                    deleteHandler={self.deleteHandler}
                                                    updateHandler={self.updateHandler}
                                                    title={todo.title}
                                                    isCompleted={todo.isCompleted}
                                            />
                                    )
                                })
                            }
                        </div>
                );
            }
        });

        var App = React.createClass({
            render: function () {
                return (
                        <div className="application">
                            <div>
                                <h1>TODO List</h1>
                            </div>
                            <TodoList />
                        </div>
                );
            }
        });

        ReactDOM.render(
                <div>
                    <App title="New Application" subTitle="hello world!"/>
                </div>,
                document.getElementById('example')
        );
    </script>
</body>
</html>